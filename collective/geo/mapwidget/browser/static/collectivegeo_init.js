/*global window, jQuery, document, OpenLayers, google*/


// = Collective Geo init =
//
// This script initialize collective.geo maps for each .wiget-cgmap
// collectivegeo.js for details


(function ($) {
    "use strict";

    // == Load maps ==
    //
    // After page has been loaded and the dom tree is fully instantiated
    // collective.geo javascript initalizes maps for each
    // {{{.widget-cgmap}}} div
    //
    // For each map you can customize some properties using data attributes
    //
    // * cgeolongitude
    // * cgeolatitude
    // * cgeozoom
    // * cgeolang
    //
    // you can also pass some default parameter to c.geo plugin:
    // For example.:
    //
    // {{{
    // maps.collectivegeo({
    //     center: new OpenLayers.LonLat('45.00', '7.3'),
    //     zoom: 7,
    //     lang: 'it'
    // });
    // }}}
    $(window).bind("load", function () {
        var maps = $('.widget-cgmap'),
            fieldset = $(maps).parents('.formPanel'),
            tabs;

        maps.collectivegeo({
            // center: new OpenLayers.LonLat('45.00', '7.3'),
            // zoom: 7,
            // lang: 'it'
        });

        // === map in tabs ==
        //
        // when a map is displayed in a hidden tab or div
        // it has to be refreshed when the tab is show.
        //
        // This trick is working with jquerytools tabs in Plone forms
        // and also with tabs generated by {{{enableFormTabbing}}} class:
        // {{{
        //
        // <dl class="enableFormTabbing">
        //   ...
        //   <dt id="fieldsetlegend-map"><h2>My Map</h2></dt>
        //   <dd id="fieldset-map">
        //     <div id="mymap" class="widget-cgmap"></div>
        //   </dd>
        //   ...
        // </dl>
        //
        // }}}
        if (fieldset.length > 0) {
            tabs = $('select.formTabs, ul.formTabs');

            tabs.bind("onClick", function (e, index) {
                var curpanel = $(this).data('tabs').getCurrentPane();
                curpanel.find('.widget-cgmap').collectivegeo('refresh');
            });
        }

    });


    // $(els[0]).collectivegeo(
    //     'add_layer',
    //     function () {
    //         return new OpenLayers.Layer.Google(
    //             'Terrain (Google)',
    //             {
    //                 type: google.maps.MapTypeId.TERRAIN,
    //                 numZoomLevels: 20,
    //                 sphericalMercator: true,
    //                 transitionEffect: 'resize'
    //             }
    //         );
    //     }
    // );

    // $(els[1]).collectivegeo(
    //     'add_markeredit_layer',
    //      'lon','lat','zoom'
    // );
    // alert($('#geoshapemap').is(":visible"));

    // $(window).bind('mapload', function (evt, widget) {
    //     widget.addLayers(
    //         [
    //             function () {
    //                 return new OpenLayers.Layer.Google(
    //                     'Terrain (Google)',
    //                     {
    //                         type: google.maps.MapTypeId.TERRAIN,
    //                         numZoomLevels: 20,
    //                         sphericalMercator: true,
    //                         transitionEffect: 'resize'
    //                     }
    //                 );
    //             }
    //         ],
    //         'geoshapemap'
    //     );

    // });


}(jQuery));

